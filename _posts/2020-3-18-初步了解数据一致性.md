---
title: 初步了解数据一致性
tags: 数据库
categories: 
- MySQL
- MongoDB
date: 2020-03-18
---

## 关系型数据库的ACID
数据库管理系统中事务(transaction)的四个特性：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）<br/>
所谓事务，它是一个操作序列，这些操作要么都执行，要么都不执行，它是一个不可分割的工作单位。<br/>
* 原子性（Atomicity）：事务里的事情要么全部做完，要么执行过程中失败，此时回滚。
* ***一致性（Consistency）：数据库要处于一致的状态。例如：现有完整性约束 A+B=10,若一个事务改变了A，那么B也得必须改变***
* 隔离性（Isolation）：并发的事务之间不会相互影响。如果一个事务要访问的数据正在被另一个事务修改，只要另一个事务未提交，它所访问的数据就不受未提交数据的影响。
* 持续性（Durability）：事务一旦提交，所做的修改就会永久保存在数据库上.

## NoSQL的CAP+BASE
### CAP 
* C:Consistency（强一致性）
* A:Availability（可用性）
* P:Partition tolerance（分区容错性）<br/>
CAP理论的核心是：一个分布式系统不可能同时很好的满足一致性，可用性和分区容错性这三个需求，最多只能同时较好的满足两个。因此，根据CAP原理将NoSQL数据库分成了满足CA原则、满足CP原则和满足AP原则三大类：<br/>
CA - 单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。<br/>
CP - 满足一致性，分区容忍性的系统，通常性能不是特别高。<br/>
AP - 满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。<br/>
对于web2.0网站来说，关系数据库的很多主要特性却往往无用武之地<br/>
***数据库事务一致性需求***<br/>
很多web实时系统并不要求严格的数据库事务，对读一致性的要求很低， 有些场合对写一致性要求并不高。允许实现最终一致性。<br/>
***数据库的读写实时性需求***<br/>
对关系数据库来说，插入一条数据之后立刻查询，是肯定可以读出来这条数据的，但是对于很多web应用来说，并不要求这么高的实时性，比方说发一条消息之 后，过几秒乃至十几秒之后，我的订阅者才看到这条动态是完全可以接受的。<br/>
***对复杂的SQL查询，特别是多表关联查询的需求***<br/>
任何大数据量的web系统，都非常忌讳多个大表的关联查询，以及复杂的数据分析类型的报表查询，特别是社交类型的网站。<br/>

### BASE
***BASE就是为了解决关系数据库强一致性引起的问题而引起的可用性降低而提出的解决方案。***<br/>
BASE其实是下面三个术语的缩写：
* 基本可用（Basically Available）
* 软状态（Soft state）
* 最终一致（Eventually consistent）（目的是最终一致性）
它的思想是通过让系统放松对某一时刻数据一致性的要求来换取系统整体伸缩性和性能上改观。

## 如何保证数据的一致性
MySQL事务的数据一致性是通过Redo Log（重做日志）和Undo Log（撤消日志）实现的；<br/>
NoSQL保证数据一致性可以选择满足AP原则，牺牲部分一致性来保证可用性，使用BASE方案的最终一致性。